<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <meta name="description" content="{{BIO_ATTR}}" />
    <meta property="og:title" content="{{NAME_ATTR}}" />
    <meta property="og:description" content="{{BIO_ATTR}}" />
    <meta property="og:url" content="{{SITE_URL_ATTR}}" />
    <title>{{NAME_TEXT}}</title>

    <!-- Local Fonts (downloaded from Bunny Fonts) -->
    <link rel="stylesheet" href="assets/fonts.css" />

    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      html {
          font-size: 16px;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
      }

      /* CSS Variables for Light Theme (default) */
      :root {
          --bg-color: #ffffff;
          --text-color: #0A0B0D;
          --text-color-muted: rgba(10, 11, 13, 0.8);
          --button-bg: rgba(255, 255, 255, 0.1);
          --button-bg-hover: rgba(255, 255, 255, 0.2);
          --button-border: rgba(255, 255, 255, 0.4);
          --top-bar-button-bg: rgba(255, 255, 255, 0.7);
          --top-bar-button-bg-hover: rgba(255, 255, 255, 1);
          --top-bar-button-border: rgba(255, 255, 255, 0.4);
          --top-bar-button-icon: #000000;
          --container-bg: rgba(255, 255, 255, 0.5);
          --qr-section-bg: rgba(255, 255, 255, 0.05);
          --qr-section-border: rgba(255, 255, 255, 0.1);
          --modal-bg: rgba(0, 0, 0, 0.5);
          --modal-content-bg: #ffffff;
          --modal-text: #0A0B0D;
          --modal-close-color: #666;
          --modal-close-hover: rgba(0, 0, 0, 0.05);
          --share-button-bg: rgba(0, 0, 0, 0.03);
          --share-button-border: rgba(0, 0, 0, 0.1);
          --share-button-hover: rgba(0, 0, 0, 0.05);
          --focus-outline: rgba(10, 11, 13, 0.9);
          --link-shadow: rgba(0, 0, 0, 0.1);
          --avatar-border: rgba(255, 255, 255, 0.3);
      }

      /* CSS Variables for Dark Theme */
      [data-theme="dark"] {
          --bg-color: #0A0B0D;
          --text-color: #ffffff;
          --text-color-muted: rgba(255, 255, 255, 0.8);
          --button-bg: rgba(255, 255, 255, 0.1);
          --button-bg-hover: rgba(255, 255, 255, 0.2);
          --button-border: rgba(255, 255, 255, 0.3);
          --top-bar-button-bg: rgba(255, 255, 255, 0.1);
          --top-bar-button-bg-hover: rgba(255, 255, 255, 0.2);
          --top-bar-button-border: rgba(255, 255, 255, 0.3);
          --top-bar-button-icon: #ffffff;
          --container-bg: rgba(10, 11, 13, 0.8);
          --qr-section-bg: rgba(255, 255, 255, 0.05);
          --qr-section-border: rgba(255, 255, 255, 0.1);
          --modal-bg: rgba(0, 0, 0, 0.7);
          --modal-content-bg: #1a1b1d;
          --modal-text: #ffffff;
          --modal-close-color: #999;
          --modal-close-hover: rgba(255, 255, 255, 0.1);
          --share-button-bg: rgba(255, 255, 255, 0.05);
          --share-button-border: rgba(255, 255, 255, 0.2);
          --share-button-hover: rgba(255, 255, 255, 0.1);
          --focus-outline: rgba(255, 255, 255, 0.9);
          --link-shadow: rgba(0, 0, 0, 0.3);
          --avatar-border: rgba(255, 255, 255, 0.3);
      }

      /* Auto mode: use system preference */
      @media (prefers-color-scheme: dark) {
          :root:not([data-theme]) {
              --bg-color: #0A0B0D;
              --text-color: #ffffff;
              --text-color-muted: rgba(255, 255, 255, 0.8);
              --button-bg: rgba(255, 255, 255, 0.1);
              --button-bg-hover: rgba(255, 255, 255, 0.2);
              --button-border: rgba(255, 255, 255, 0.3);
              --top-bar-button-bg: rgba(255, 255, 255, 0.1);
              --top-bar-button-bg-hover: rgba(255, 255, 255, 0.2);
              --top-bar-button-border: rgba(255, 255, 255, 0.3);
              --top-bar-button-icon: #ffffff;
              --container-bg: rgba(10, 11, 13, 0.8);
              --qr-section-bg: rgba(255, 255, 255, 0.05);
              --qr-section-border: rgba(255, 255, 255, 0.1);
              --modal-bg: rgba(0, 0, 0, 0.7);
              --modal-content-bg: #1a1b1d;
              --modal-text: #ffffff;
              --modal-close-color: #999;
              --modal-close-hover: rgba(255, 255, 255, 0.1);
              --share-button-bg: rgba(255, 255, 255, 0.05);
              --share-button-border: rgba(255, 255, 255, 0.2);
              --share-button-hover: rgba(255, 255, 255, 0.1);
              --focus-outline: rgba(255, 255, 255, 0.9);
              --link-shadow: rgba(0, 0, 0, 0.3);
              --avatar-border: rgba(255, 255, 255, 0.3);
          }
      }

      body {
          font-family: {{FONT_FAMILY}};
          {{BACKGROUND_STYLE}}
          min-height: 100vh;
          display: flex;
          flex-direction: column;
          align-items: center;
          color: var(--text-color);
          background-color: var(--bg-color) !important;
      }

      /* Top Bar */
      .top-bar {
          position: fixed;
          top: 6px;
          left: 0;
          right: 0;
          z-index: 200;
          width: 100%;
          transition: transform 0.3s ease-out, opacity 0.3s ease-out;
      }

      .top-bar-container {
          max-width: 680px;
          margin: 0 auto;
          padding: 0.5rem;
          display: flex;
          justify-content: flex-end;
          gap: 0.5rem;
      }

      .top-bar-button {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          border: 1px solid var(--top-bar-button-border);
          background: var(--top-bar-button-bg);
          backdrop-filter: blur(8px);
          cursor: pointer;
          transition: all 0.2s;
      }

      .top-bar-button:hover {
          background: var(--top-bar-button-bg-hover);
          transform: scale(1.05);
      }

      .top-bar-button svg {
          fill: var(--top-bar-button-icon);
      }

      .top-bar-button:active {
          transform: scale(0.95);
      }

      /* Focus styles (keyboard) */
      .top-bar-button:focus-visible,
      .link-item:focus-visible,
      .modal-close:focus-visible,
      .share-button:focus-visible {
          outline: 3px solid var(--focus-outline);
          outline-offset: 3px;
      }

      /* Main Container */
      .container {
          max-width: 680px;
          width: 100%;
          padding: 80px 1rem 2rem;
          display: flex;
          flex-direction: column;
          align-items: center;
      }

      /* Visually-hidden utility (screen reader only) */
      .sr-only {
          position: absolute;
          width: 1px;
          height: 1px;
          padding: 0;
          margin: -1px;
          overflow: hidden;
          clip: rect(0, 0, 0, 0);
          white-space: nowrap;
          border: 0;
      }

      /* Profile Section */
      .profile {
          display: flex;
          flex-direction: column;
          align-items: center;
          margin-bottom: 2rem;
          text-align: center;
      }

      .avatar {
          width: 96px;
          height: 96px;
          border-radius: 50%;
          margin-bottom: 1rem;
          object-fit: cover;
          border: 3px solid var(--avatar-border);
      }

      .profile-name {
          font-size: 1.25rem;
          font-weight: 600;
          margin-bottom: 0.5rem;
          color: var(--text-color);
      }

      .profile-bio {
          font-size: 1rem;
          color: var(--text-color-muted);
      }

      /* Links Container */
      .links {
          width: 100%;
          display: flex;
          flex-direction: column;
          gap: 1rem;
          margin-bottom: 2rem;
      }

      .link-item {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 0.75rem;
          padding: 1rem 1.5rem;
          background: var(--button-bg);
          border: 1px solid var(--button-border);
          border-radius: 0.5rem;
          text-decoration: none;
          color: var(--text-color);
          font-weight: 500;
          transition: all 0.2s;
          position: relative;
          overflow: hidden;
      }

      .link-item::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: linear-gradient(180deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 100%);
          pointer-events: none;
      }

      .link-item:hover {
          background: var(--button-bg-hover);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px var(--link-shadow);
      }

      .link-item:active {
          transform: translateY(0);
      }

      .link-icon {
          font-size: 1.25rem;
          min-width: 24px;
          text-align: center;
      }

      .link-image {
          width: 48px;
          height: 48px;
          border-radius: 0.375rem;
          object-fit: cover;
          flex-shrink: 0;
      }

      .link-title {
          font-size: 1rem;
      }

      /* QR Code Section */
      .qr-section {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 1rem;
          margin-top: 2rem;
          padding: 2rem;
          background: var(--qr-section-bg);
          border-radius: 1rem;
          border: 1px solid var(--qr-section-border);
      }

      .qr-title {
          font-size: 0.875rem;
          font-weight: 600;
          opacity: 0.7;
          text-transform: uppercase;
          letter-spacing: 0.5px;
      }

      .qr-code {
          background: white;
          padding: 1rem;
          border-radius: 0.5rem;
      }

      .qr-code img {
          display: block;
          max-width: 200px;
          height: auto;
      }

      /* Share Modal */
      .modal {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: var(--modal-bg);
          backdrop-filter: blur(4px);
          z-index: 1000;
          align-items: center;
          justify-content: center;
      }

      .modal.active {
          display: flex;
      }

      .modal-content {
          background: var(--modal-content-bg);
          padding: 2rem;
          border-radius: 1rem;
          max-width: 400px;
          width: 90%;
          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }

      .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
      }

      .modal-title {
          font-size: 1.25rem;
          font-weight: 600;
          color: var(--modal-text);
      }

      .modal-close {
          background: none;
          border: none;
          font-size: 1.5rem;
          cursor: pointer;
          color: var(--modal-close-color);
          width: 32px;
          height: 32px;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 50%;
          transition: all 0.2s;
      }

      .modal-close:hover {
          background: var(--modal-close-hover);
      }

      .share-options {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 1rem;
      }

      .share-button {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 0.5rem;
          padding: 1rem;
          background: var(--share-button-bg);
          border: 1px solid var(--share-button-border);
          border-radius: 0.5rem;
          cursor: pointer;
          transition: all 0.2s;
          text-decoration: none;
          color: var(--modal-text);
      }

      .share-button:hover {
          background: var(--share-button-hover);
          transform: translateY(-2px);
      }

      .share-button i {
          font-size: 1.5rem;
      }

      .share-button span {
          font-size: 0.875rem;
          font-weight: 500;
      }

      /* Responsive */
      @media (max-width: 640px) {
          .top-bar {
              top: 6px;
          }

          .container {
              padding-top: 60px;
          }
      }

      @media (min-width: 640px) {
          .top-bar {
              top: 3.5rem;
          }

          .container {
              padding-top: 20px;
              background: var(--container-bg);
              border-radius: 1rem 1rem 0 0;
              box-shadow: 0 24px 32px rgba(0, 0, 0, 0.15);
              min-height: calc(100vh - 2.5rem);
          }
      }

      /* Theme toggle button styles */
      .theme-toggle {
          position: relative;
      }

      .theme-toggle-menu {
          display: none;
          position: absolute;
          top: calc(100% + 0.5rem);
          right: 0;
          background: var(--top-bar-button-bg);
          backdrop-filter: blur(8px);
          border: 1px solid var(--top-bar-button-border);
          border-radius: 0.5rem;
          padding: 0.5rem;
          min-width: 120px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .theme-toggle.active .theme-toggle-menu {
          display: block;
      }

      .theme-option {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          padding: 0.5rem 0.75rem;
          border-radius: 0.375rem;
          cursor: pointer;
          color: var(--text-color);
          font-size: 0.875rem;
          transition: background 0.2s;
      }

      .theme-option:hover {
          background: var(--top-bar-button-bg-hover);
      }

      .theme-option.active {
          font-weight: 600;
      }
    </style>
  </head>
  <body>
    <!-- Top Bar -->
    <div class="top-bar">
      <div class="top-bar-container">
        <div class="theme-toggle" id="themeToggle">
          <button
            class="top-bar-button"
            onclick="toggleThemeMenu()"
            aria-label="Theme settings"
            aria-haspopup="menu"
            aria-expanded="false"
            id="themeToggleButton"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 256 256"
              id="themeIcon"
            >
              <path
                d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24ZM40,128a88.1,88.1,0,0,1,88-88,87.48,87.48,0,0,1,24.81,3.58A88,88,0,0,0,64.58,152.81,87.48,87.48,0,0,1,40,128Zm88,88a87.48,87.48,0,0,1-24.81-3.58A88,88,0,0,0,191.42,103.19,87.48,87.48,0,0,1,216,128,88.1,88.1,0,0,1,128,216Z"
              ></path>
            </svg>
          </button>
          <div class="theme-toggle-menu" role="menu" id="themeMenu">
            <div
              class="theme-option active"
              data-theme="auto"
              role="menuitem"
              onclick="setTheme('auto')"
            >
              <span>Auto</span>
            </div>
            <div
              class="theme-option"
              data-theme="light"
              role="menuitem"
              onclick="setTheme('light')"
            >
              <span>Light</span>
            </div>
            <div
              class="theme-option"
              data-theme="dark"
              role="menuitem"
              onclick="setTheme('dark')"
            >
              <span>Dark</span>
            </div>
          </div>
        </div>
        <button
          class="top-bar-button"
          onclick="openShareModal()"
          aria-label="Share profile"
          aria-haspopup="dialog"
          aria-controls="shareModal"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 256 256"
          >
            <path
              d="M216,112v96a16,16,0,0,1-16,16H56a16,16,0,0,1-16-16V112A16,16,0,0,1,56,96H80a8,8,0,0,1,0,16H56v96H200V112H176a8,8,0,0,1,0-16h24A16,16,0,0,1,216,112ZM93.66,69.66,120,43.31V136a8,8,0,0,0,16,0V43.31l26.34,26.35a8,8,0,0,0,11.32-11.32l-40-40a8,8,0,0,0-11.32,0l-40,40A8,8,0,0,0,93.66,69.66Z"
            ></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Main Container -->
    <main class="container" id="main">
      <!-- Profile Section -->
      <div class="profile">
        <img src="{{AVATAR_URL_ATTR}}" alt="{{NAME_ATTR}}" class="avatar" />
        <h1 class="profile-name">{{NAME_TEXT}}</h1>
        <p class="profile-bio">{{BIO_TEXT}}</p>
      </div>

      <!-- Links -->
      <div class="links">{{LINKS}}</div>

      <!-- QR Code Section -->
      <div class="qr-section">
        <div class="qr-title">Scan to visit</div>
        <div class="qr-code">
          <img src="qrcode.png" alt="QR Code" />
        </div>
      </div>
    </main>

    <!-- Share Modal -->
    <div
      class="modal"
      id="shareModal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="shareModalTitle"
      onclick="closeShareModal(event)"
    >
      <div
        class="modal-content"
        onclick="event.stopPropagation()"
        tabindex="-1"
      >
        <div class="modal-header">
          <h2 class="modal-title" id="shareModalTitle">Share this page</h2>
          <button
            class="modal-close"
            type="button"
            aria-label="Close share dialog"
            onclick="closeShareModal()"
          >
            &times;
          </button>
        </div>
        <div class="share-options">
          <button
            class="share-button"
            type="button"
            onclick="copyToClipboard()"
          >
            <i class="fas fa-link"></i>
            <span>Copy Link</span>
          </button>
          <div id="shareStatus" class="sr-only" aria-live="polite"></div>
          <a class="share-button" href="{{SHARE_EMAIL_HREF_ATTR}}">
            <i class="fas fa-envelope"></i>
            <span>Email</span>
          </a>
        </div>
      </div>
    </div>

    <script>
      let lastFocusedElement = null;

      // Theme management
      function getStoredTheme() {
          return localStorage.getItem('theme') || 'auto';
      }

      function setStoredTheme(theme) {
          localStorage.setItem('theme', theme);
      }

      function applyTheme(theme) {
          const html = document.documentElement;
          if (theme === 'auto') {
              html.removeAttribute('data-theme');
          } else {
              html.setAttribute('data-theme', theme);
          }
          updateThemeIcon(theme);
          updateThemeMenu(theme);
      }

      function updateThemeIcon(theme) {
          const icon = document.getElementById('themeIcon');
          if (!icon) return;

          // Auto icon (system preference)
          let iconPath = 'M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24ZM40,128a88.1,88.1,0,0,1,88-88,87.48,87.48,0,0,1,24.81,3.58A88,88,0,0,0,64.58,152.81,87.48,87.48,0,0,1,40,128Zm88,88a87.48,87.48,0,0,1-24.81-3.58A88,88,0,0,0,191.42,103.19,87.48,87.48,0,0,1,216,128,88.1,88.1,0,0,1,128,216Z';

          if (theme === 'light') {
              // Sun icon
              iconPath = 'M128,56a72,72,0,1,0,72,72A72,72,0,0,0,128,56Zm0,128a56,56,0,1,1,56-56A56,56,0,0,1,128,184ZM128,24a8,8,0,0,0,8-8V8a8,8,0,0,0-16,0v8A8,8,0,0,0,128,24Zm0,208a8,8,0,0,0-8,8v8a8,8,0,0,0,16,0v-8A8,8,0,0,0,128,232ZM232,128a8,8,0,0,0-8-8h-8a8,8,0,0,0,0,16h8A8,8,0,0,0,232,128ZM40,128a8,8,0,0,0-8,8h8a8,8,0,0,0,0-16H32A8,8,0,0,0,40,128Zm165.66-58.34a8,8,0,0,0,11.32-11.32l-5.66-5.66a8,8,0,0,0-11.32,11.32ZM50.34,203.66a8,8,0,0,0,11.32,11.32l5.66-5.66a8,8,0,0,0-11.32-11.32ZM203.66,203.66a8,8,0,0,0,5.66,2.34,8,8,0,0,0,5.66-2.34l5.66-5.66a8,8,0,0,0-11.32-11.32ZM67.72,67.72a8,8,0,0,0,11.32,11.32l5.66-5.66a8,8,0,0,0-11.32-11.32Z';
          } else if (theme === 'dark') {
              // Moon icon
              iconPath = 'M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,0,1-88-88,88.13,88.13,0,0,1,88-88,8,8,0,0,0,0-16A104.11,104.11,0,0,0,24,128,104,104,0,0,0,128,232a8,8,0,0,0,0-16Z';
          }

          icon.innerHTML = `<path d="${iconPath}"></path>`;
      }

      function updateThemeMenu(theme) {
          const menu = document.getElementById('themeMenu');
          if (!menu) return;

          const options = menu.querySelectorAll('.theme-option');
          options.forEach(option => {
              if (option.dataset.theme === theme) {
                  option.classList.add('active');
              } else {
                  option.classList.remove('active');
              }
          });
      }

      function setTheme(theme) {
          setStoredTheme(theme);
          applyTheme(theme);
          closeThemeMenu();
      }

      function toggleThemeMenu() {
          const toggle = document.getElementById('themeToggle');
          const button = document.getElementById('themeToggleButton');
          if (!toggle || !button) return;

          const isActive = toggle.classList.contains('active');
          if (isActive) {
              closeThemeMenu();
          } else {
              toggle.classList.add('active');
              button.setAttribute('aria-expanded', 'true');
          }
      }

      function closeThemeMenu() {
          const toggle = document.getElementById('themeToggle');
          const button = document.getElementById('themeToggleButton');
          if (!toggle || !button) return;

          toggle.classList.remove('active');
          button.setAttribute('aria-expanded', 'false');
      }

      // Close theme menu when clicking outside
      document.addEventListener('click', (e) => {
          const toggle = document.getElementById('themeToggle');
          if (!toggle) return;

          if (!toggle.contains(e.target)) {
              closeThemeMenu();
          }
      });

      // Initialize theme on page load
      (function() {
          const theme = getStoredTheme();
          applyTheme(theme);
      })();

      // Listen for system theme changes when in auto mode
      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
      mediaQuery.addEventListener('change', () => {
          if (getStoredTheme() === 'auto') {
              applyTheme('auto');
          }
      });

      function isShareModalOpen() {
        return document.getElementById('shareModal').classList.contains('active');
      }

      function openShareModal() {
        const modal = document.getElementById('shareModal');
        lastFocusedElement = document.activeElement;
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';

        // Move focus into the dialog
        const closeBtn = modal.querySelector('.modal-close');
        if (closeBtn) closeBtn.focus();
      }

      function closeShareModal(event) {
        const modal = document.getElementById('shareModal');
        if (!event || event.target === modal) {
          modal.classList.remove('active');
          document.body.style.overflow = '';

          // Restore focus to the opener
          if (lastFocusedElement && typeof lastFocusedElement.focus === 'function') {
            lastFocusedElement.focus();
          }
          lastFocusedElement = null;
        }
      }

      function setShareStatus(message) {
        const el = document.getElementById('shareStatus');
        if (!el) return;
        el.textContent = message;
        // Clear after a moment to allow repeated announcements
        window.setTimeout(() => {
          if (el.textContent === message) el.textContent = '';
        }, 2000);
      }

      function copyToClipboard() {
        const url = {{SITE_URL_JSON}};
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard
            .writeText(url)
            .then(() => setShareStatus('Link copied to clipboard.'))
            .catch(() => fallbackCopyToClipboard(url));
        } else {
          fallbackCopyToClipboard(url);
        }
      }

      function fallbackCopyToClipboard(text) {
        try {
          const textarea = document.createElement('textarea');
          textarea.value = text;
          textarea.setAttribute('readonly', '');
          textarea.style.position = 'fixed';
          textarea.style.top = '-9999px';
          textarea.style.left = '-9999px';
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand('copy');
          document.body.removeChild(textarea);
          setShareStatus('Link copied to clipboard.');
        } catch (err) {
          console.error('Failed to copy:', err);
          setShareStatus('Unable to copy link.');
        }
      }

      function trapShareModalFocus(e) {
        if (!isShareModalOpen() || e.key !== 'Tab') return;

        const modal = document.getElementById('shareModal');
        const focusables = modal.querySelectorAll(
          'a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])'
        );
        if (!focusables.length) return;

        const first = focusables[0];
        const last = focusables[focusables.length - 1];
        const active = document.activeElement;

        if (e.shiftKey) {
          if (active === first || active === modal) {
            e.preventDefault();
            last.focus();
          }
        } else {
          if (active === last) {
            e.preventDefault();
            first.focus();
          }
        }
      }

      // Close modal on Escape key
      document.addEventListener('keydown', e => {
        if (e.key === 'Escape' && isShareModalOpen()) {
          closeShareModal();
        }
      });

      // Trap focus inside the modal while open
      document.addEventListener('keydown', trapShareModalFocus);
    </script>
  </body>
</html>
